FROM trussworks/circleci-docker-primary:6f138d780444b35181e0048282616f75a451d7b4

ENV GOPATH=/home/circleci/go
ENV GOBIN=$GOPATH/bin
ENV PATH=$GOBIN:$PATH

COPY --chown=circleci:circleci . /home/circleci/milmove
WORKDIR /home/circleci/milmove
RUN mkdir -p /home/circleci/.cache/
RUN chown circleci:circleci /home/circleci/.cache/

RUN make go_deps_update
RUN make client_deps_update
RUN git --no-pager status && git --no-pager diff --ignore-all-space --color
